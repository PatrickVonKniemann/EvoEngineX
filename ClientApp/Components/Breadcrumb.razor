@using DomainModels
@inject NavigationManager Navigation

<nav class="flex" aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-1">
        <li class="inline-flex items-center">
            <a href="/" class="mt-1 inline-flex items-center font-medium text-gray-700 hover:text-indigo-600 cursor-pointer">
                <i class="fas fa-home text-lg"></i>
            </a>
        </li>
        @foreach (var item in BreadcrumbItems)
        {
            <li class="inline-flex items-center pt-2">
                <i class="fas fa-chevron-right mr-4 ml-4 text-gray-900"></i>
                @if (item.IsCurrent)
                {
                    <span class="text-sm font-medium text-gray-900 hover:text-indigo-600 cursor-pointer">@item.Title</span>
                }
                else
                {
                    <a href="@item.Url" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-indigo-600 hover:font-bold cursor-pointer">
                        @item.Title
                    </a>
                }
            </li>
        }
    </ol>
</nav>

@code {
    [CascadingParameter] public string? CurrentUri { get; set; }

    private List<BreadcrumbItem> BreadcrumbItems { get; set; } = new List<BreadcrumbItem>();

    protected override void OnParametersSet()
    {
        BuildBreadcrumbs();
    }

    private void BuildBreadcrumbs()
    {
        BreadcrumbItems.Clear();
        if (CurrentUri is null) return;

        var segments = Navigation.ToBaseRelativePath(CurrentUri).Split('/', StringSplitOptions.RemoveEmptyEntries);
        var currentUrl = "/";
        foreach (var segment in segments)
        {
            currentUrl += segment + "/";

            Links.SegmentAliases.TryGetValue(segment, out var alias);
            alias ??= segment;

            BreadcrumbItems.Add(new BreadcrumbItem
            {
                Title = alias,
                Url = currentUrl,
                IsCurrent = (currentUrl == Navigation.ToBaseRelativePath(CurrentUri) + "/")
            });
        }
    }

    public class BreadcrumbItem
    {
        public string Title { get; set; }
        public string Url { get; set; }
        public bool IsCurrent { get; set; }
    }

}